@page
@using Azure.Identity
@using System.ComponentModel
@model TCG_COMPANION.Pages.MessageModel
@{
    ViewData["Title"] = "Message";
}
<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <link rel="stylesheet" href="~/css/pokemon.css" />
</head>

<body  class="text-center" style="background-color:#2c2c2c; color:#f5f5f5;">
    @await Html.PartialAsync("_Navbar")  
    <div>
        @if(!string.IsNullOrEmpty(Model.DisplayName)){
            <h1 class="display-4 mb-5 text-primary">Welcome To Global Chat @Model.DisplayName</h1>
            <input id = "username" type="hidden" value="@Model.DisplayName"/>
        }
        else{
            <h1 class="display-4 mb-5 text-primary">Welcome To Global Chat</h1>
            <input id="username" placeholder="username" type="text" />
        }
        <input id="message" placeholder="Please enter a message"type="text" />
        <button id="send-btn">Send</button>
    </div>
    <div id="chatBox">
    </div>
    <script>
        let connection = new signalR.HubConnectionBuilder()
                                    .withUrl("/chatHub").build();
        connection.on("ReceiveMessage", function (user, message) {
            let encodedUser = $("<div />").text(user).html();
            let encodedMsg = $("<div />").text(message).html();
            $("#chatBox").append("<p><strong>" + encodedUser + "</strong>: " + encodedMsg + "</p>");
        });

        $("#send-btn").click(function () {
            let our_user = $("#username").val();
            let message = $("#message").val();
            connection.invoke("Message", our_user, message);
            $("#message").val("").focus();
        });


        connection.start().then(function () {
            console.log("Connected!");
        }).catch(function (err) {
            console.error(err.toString());
        });
    </script>
</body>

</html>